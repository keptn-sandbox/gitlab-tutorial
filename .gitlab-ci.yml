#
# Dynatrace Demo CI/CD Pipeline
#

#################################################################
# Global Variables
#################################################################
variables:
  APPLICATION_NAME: sample-app

include: 
  - local: 'ci-includes/dt_deploy-eks-oneagent.yml'


stages:
  - aws-eks-provisioning
  - configure-dynatrace

#################################################################
# Provisioning Stage
#################################################################
create-aws-environment:
  stage: aws-eks-provisioning
  image: registry.gitlab.com/checkelmann/cicd-tools:latest
  environment:
      name: test
  variables:
      GIT_STRATEGY: none
  script:
      - aws ec2 describe-regions
      - eksctl get clustsers
  when: manual

deploy_oneagent:
  stage: configure-dynatrace
  extends: -dt_deploy-eks-oneagent
  environment:
    name: test
  when: manual